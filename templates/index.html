<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å¾·å·æ‰‘å…‹ - è±ªåèµŒåœº</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        // Socket.IO è¿æ¥é…ç½®
        window.addEventListener('load', function() {
            const socket = io({
                transports: ['websocket', 'polling'],
                reconnection: true,
                reconnectionAttempts: 5,
                reconnectionDelay: 1000
            });

            socket.on('connect', function() {
                console.log('Socket.IOè¿æ¥æˆåŠŸ');
            });

            socket.on('connect_error', function(error) {
                console.error('Socket.IOè¿æ¥é”™è¯¯:', error);
            });

            window.socket = socket;
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div id="login-screen" class="screen">
            <div class="casino-logo">
                <div class="logo-icon"><i class="fas fa-crown"></i></div>
                <h1>è±ªåå¾·å·æ‰‘å…‹</h1>
                <div class="tagline">å°Šè´µä½“éªŒï¼Œå°½åœ¨æŒæ¡</div>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="create">åˆ›å»ºæˆ¿é—´</button>
                <button class="tab-btn" data-tab="join">åŠ å…¥æˆ¿é—´</button>
            </div>
            
            <div class="tab-content">
                <!-- åˆ›å»ºæˆ¿é—´è¡¨å• -->
                <div id="create-tab" class="tab-pane active">
                    <div class="login-form">
                        <div class="avatar-selection">
                            <label>é€‰æ‹©å¤´åƒ</label>
                            <div class="avatar-options">
                                <div class="avatar-option selected" data-avatar="avatar1"><i class="fas fa-user-tie"></i></div>
                                <div class="avatar-option" data-avatar="avatar2"><i class="fas fa-user-ninja"></i></div>
                                <div class="avatar-option" data-avatar="avatar3"><i class="fas fa-user-astronaut"></i></div>
                                <div class="avatar-option" data-avatar="avatar4"><i class="fas fa-user-secret"></i></div>
                                <div class="avatar-option" data-avatar="avatar5"><i class="fas fa-user-crown"></i></div>
                            </div>
                        </div>
                        
                        <input type="text" id="create-username" placeholder="è¾“å…¥æ‚¨çš„å°Šè´µæ˜µç§°">
                        
                        <div class="form-group">
                            <label>æ¸¸æˆè®¾ç½®</label>
                            <div class="game-settings">
                                <div class="setting-item">
                                    <span class="setting-label">å°ç›²æ³¨</span>
                                    <input type="number" id="small-blind" placeholder="å°ç›²æ³¨é‡‘é¢" value="10">
                                </div>
                                <div class="setting-item">
                                    <span class="setting-label">å¤§ç›²æ³¨</span>
                                    <input type="number" id="big-blind" placeholder="å¤§ç›²æ³¨é‡‘é¢" value="20">
                                </div>
                                <div class="setting-item">
                                    <span class="setting-label">ALL INåå‘ç‰Œæ¬¡æ•°</span>
                                    <input type="number" id="all-in-rounds" placeholder="ALL INåå‘ç‰Œæ¬¡æ•°" value="3">
                                </div>
                                <div class="setting-item">
                                    <span class="setting-label">åˆå§‹ç­¹ç </span>
                                    <input type="number" id="initial-chips" placeholder="åˆå§‹ç­¹ç " value="1000">
                                </div>
                            </div>
                        </div>
                        
                        <button id="create-room-btn" class="gold-btn">åˆ›å»ºè±ªåæˆ¿é—´</button>
                    </div>
                </div>
                
                <!-- åŠ å…¥æˆ¿é—´è¡¨å• -->
                <div id="join-tab" class="tab-pane">
                    <div class="login-form">
                        <div class="avatar-selection">
                            <label>é€‰æ‹©å¤´åƒ</label>
                            <div class="avatar-options">
                                <div class="avatar-option selected" data-avatar="avatar1"><i class="fas fa-user-tie"></i></div>
                                <div class="avatar-option" data-avatar="avatar2"><i class="fas fa-user-ninja"></i></div>
                                <div class="avatar-option" data-avatar="avatar3"><i class="fas fa-user-astronaut"></i></div>
                                <div class="avatar-option" data-avatar="avatar4"><i class="fas fa-user-secret"></i></div>
                                <div class="avatar-option" data-avatar="avatar5"><i class="fas fa-user-crown"></i></div>
                            </div>
                        </div>
                        
                        <input type="text" id="join-username" placeholder="è¾“å…¥æ‚¨çš„å°Šè´µæ˜µç§°">
                        <input type="text" id="room-id" placeholder="è¾“å…¥æˆ¿é—´å·">
                        
                        <button id="join-room-btn" class="gold-btn" style="position: relative; background: linear-gradient(to bottom, #ff9500, #ff3b30); box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3); font-weight: bold;" onclick="joinRoomDirectly(); return false;">åŠ å…¥è±ªåæˆ¿é—´</button>
                    </div>
                </div>
            </div>
            
            <!-- æˆ¿é—´åˆ›å»ºæˆåŠŸæç¤º -->
            <div id="room-created" class="notification hidden">
                <div class="notification-content">
                    <h3>æˆ¿é—´åˆ›å»ºæˆåŠŸ!</h3>
                    <p>æ‚¨çš„æˆ¿é—´å·ï¼š<span id="created-room-id" class="room-id-display">12345</span></p>
                    <p>åˆ†äº«ç»™å¥½å‹ï¼Œé‚€è¯·ä»–ä»¬åŠ å…¥</p>
                    <button id="copy-room-id" class="copy-btn"><i class="fas fa-copy"></i> å¤åˆ¶æˆ¿é—´å·</button>
                    <button id="enter-room-btn" class="gold-btn">è¿›å…¥æˆ¿é—´</button>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="game-screen" class="screen hidden">
            <div class="game-header">
                <div class="room-info">
                    <span class="room-label">æˆ¿é—´å·: <span id="display-room-id">12345</span></span>
                    <button id="copy-game-room-id" class="copy-btn small"><i class="fas fa-copy"></i></button>
                </div>
                <div class="game-status">
                    <span id="game-status-text">ç­‰å¾…ç©å®¶åŠ å…¥...</span>
                </div>
                <div class="pot-container">
                    <div class="pot-chips"></div>
                    <div class="pot">åº•æ± : <span id="pot-amount">0</span></div>
                </div>
                <div class="leaderboard-toggle" id="leaderboard-toggle">
                    <i class="fas fa-trophy"></i>
                </div>
            </div>

            <!-- æ’è¡Œæ¦œé¢æ¿ -->
            <div id="leaderboard-panel" class="leaderboard-panel">
                <div class="leaderboard-content">
                    <div class="leaderboard-header">
                        <h3>æ’è¡Œæ¦œ</h3>
                        <button id="close-leaderboard" class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="leaderboard-tabs">
                        <button class="leaderboard-tab active" data-tab="room">æˆ¿é—´æ’å</button>
                        <button class="leaderboard-tab" data-tab="history">å†å²æœ€ä½³</button>
                    </div>
                    <div class="leaderboard-tab-content">
                        <div id="room-leaderboard" class="leaderboard-pane active">
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>æ’å</th>
                                        <th>ç©å®¶</th>
                                        <th>å½“å‰ç­¹ç </th>
                                        <th>å‡€èµ¢å¾—</th>
                                    </tr>
                                </thead>
                                <tbody id="room-leaderboard-body">
                                    <!-- æˆ¿é—´æ’è¡Œæ¦œæ•°æ®å°†åŠ¨æ€æ’å…¥ -->
                                </tbody>
                            </table>
                        </div>
                        <div id="history-leaderboard" class="leaderboard-pane">
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>æ’å</th>
                                        <th>ç©å®¶</th>
                                        <th>æœ€é«˜ç­¹ç </th>
                                        <th>æ¸¸æˆåœºæ¬¡</th>
                                    </tr>
                                </thead>
                                <tbody id="history-leaderboard-body">
                                    <!-- å†å²æ’è¡Œæ¦œæ•°æ®å°†åŠ¨æ€æ’å…¥ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç­‰å¾…ç©å®¶é¢æ¿ -->
            <div id="waiting-panel" class="panel">
                <div class="waiting-content">
                    <h2>ç­‰å¾…ç©å®¶åŠ å…¥</h2>
                    
                    <div class="room-id-display">
                        <div>
                            <span class="room-id-label">æˆ¿é—´å·:</span>
                            <span id="room-id-value" class="room-id-value">-</span>
                        </div>
                        <button id="copy-room-id" class="copy-btn">å¤åˆ¶</button>
                    </div>
                    
                    <div class="player-status">
                        <p>å½“å‰ç©å®¶: <span id="current-player-count">1</span>/10</p>
                        <div id="waiting-players" class="waiting-players"></div>
                    </div>
                    
                    <div id="host-controls" class="host-controls">
                        <p><span class="host-tag">æˆ¿ä¸»</span> æ‚¨å¯ä»¥å†³å®šä½•æ—¶å¼€å§‹æ¸¸æˆ</p>
                        <button id="start-game-btn" class="btn" disabled>å¼€å§‹æ¸¸æˆ (è‡³å°‘éœ€è¦2ä½ç©å®¶)</button>
                    </div>
                </div>
            </div>

            <div class="poker-table">
                <div class="table-felt">
                    <div class="table-logo">
                        <i class="fas fa-crown"></i>
                        <span>è±ªåå¾·å·</span>
                    </div>
                    
                    <div class="community-cards-container">
                        <div class="community-cards" id="community-cards"></div>
                    </div>
                    
                    <div class="players-container" id="players-container">
                        <!-- ç©å®¶ä½ç½®ä¼šåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <div class="player-controls">
                <div class="player-info-area">
                    <div class="player-avatar">
                        <i id="player-avatar-icon" class="fas fa-user-tie"></i>
                    </div>
                    <div class="player-stats">
                        <div class="player-name" id="player-name">ç©å®¶åç§°</div>
                        <div class="player-chips-info">ç­¹ç : <span id="player-chips">1000</span></div>
                    </div>
                </div>
                
                <div class="player-cards" id="player-cards"></div>
                
                <div class="action-controls">
                    <div class="action-timer" id="action-timer">
                        <div class="timer-progress"></div>
                        <span class="timer-seconds">30</span>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="fold-btn" class="action-btn fold-btn"><i class="fas fa-times"></i> å¼ƒç‰Œ</button>
                        <button id="check-btn" class="action-btn check-btn"><i class="fas fa-check"></i> çœ‹ç‰Œ</button>
                        <button id="call-btn" class="action-btn call-btn"><i class="fas fa-sync-alt"></i> è·Ÿæ³¨</button>
                        <div class="raise-control">
                            <button id="raise-btn" class="action-btn raise-btn"><i class="fas fa-arrow-up"></i> åŠ æ³¨</button>
                            <input type="number" id="raise-amount" class="raise-input" placeholder="åŠ æ³¨é‡‘é¢">
                            <div class="raise-slider-container">
                                <input type="range" id="raise-slider" min="0" max="1000" step="10" value="0">
                                <div class="slider-labels">
                                    <span>MIN</span>
                                    <span>MAX</span>
                                </div>
                            </div>
                        </div>
                        <button id="all-in-btn" class="action-btn all-in-btn"><i class="fas fa-rocket"></i> ALL IN</button>
                    </div>
                    
                    <div class="bet-info">
                        <span>å½“å‰ä¸‹æ³¨: <span id="current-bet">0</span></span>
                    </div>
                </div>
            </div>
            
            <!-- æ¸¸æˆç»“æœæ˜¾ç¤º -->
            <div id="game-result" class="game-result hidden">
                <div class="result-content">
                    <h2>æœ¬å±€ç»“æœ</h2>
                    <div id="winners-list" class="winners-list">
                        <!-- è·èƒœè€…ä¿¡æ¯å°†åŠ¨æ€æ’å…¥ -->
                    </div>
                    <div class="result-actions">
                        <button id="view-history-btn" class="history-btn"><i class="fas fa-history"></i> å›çœ‹æœ¬å±€</button>
                        <button id="next-game-btn" class="gold-btn">ä¸‹ä¸€å±€</button>
                    </div>
                </div>
            </div>

            <!-- æ¸¸æˆå†å²å›çœ‹é¢æ¿ -->
            <div id="history-panel" class="history-panel hidden">
                <div class="history-content">
                    <div class="history-header">
                        <h3>æ¸¸æˆå›é¡¾</h3>
                        <button id="close-history" class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="history-timeline">
                        <div class="timeline-controls">
                            <button id="history-prev" class="timeline-btn"><i class="fas fa-step-backward"></i></button>
                            <div class="timeline-stage">
                                <span id="history-stage">å‘ç‰Œå‰</span>
                                <div class="timeline-progress">
                                    <div id="timeline-progress-bar" class="timeline-progress-bar"></div>
                                </div>
                            </div>
                            <button id="history-next" class="timeline-btn"><i class="fas fa-step-forward"></i></button>
                        </div>
                    </div>
                    <div class="history-table">
                        <div class="history-community-cards" id="history-community-cards"></div>
                        <div class="history-pot">åº•æ± : <span id="history-pot">0</span></div>
                        <div class="history-players-container" id="history-players-container"></div>
                    </div>
                </div>
            </div>

            <!-- èŠå¤©ç³»ç»Ÿ -->
            <div id="chat-system" class="chat-system">
                <div class="chat-toggle" id="chat-toggle">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="chat-container">
                    <div class="chat-header">
                        <h3>èŠå¤©å®¤</h3>
                        <button id="close-chat" class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="emoji-picker-container">
                        <div id="emoji-picker" class="emoji-picker">
                            <div class="emoji-group">
                                <span class="emoji" data-emoji="ğŸ˜€">ğŸ˜€</span>
                                <span class="emoji" data-emoji="ğŸ˜">ğŸ˜</span>
                                <span class="emoji" data-emoji="ğŸ¤”">ğŸ¤”</span>
                                <span class="emoji" data-emoji="ğŸ˜‚">ğŸ˜‚</span>
                                <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                <span class="emoji" data-emoji="ğŸ²">ğŸ²</span>
                                <span class="emoji" data-emoji="ğŸ¯">ğŸ¯</span>
                                <span class="emoji" data-emoji="ğŸ°">ğŸ°</span>
                                <span class="emoji" data-emoji="ğŸ’°">ğŸ’°</span>
                                <span class="emoji" data-emoji="ğŸ’¸">ğŸ’¸</span>
                                <span class="emoji" data-emoji="ğŸ¤‘">ğŸ¤‘</span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <button id="show-emojis" class="emoji-btn"><i class="fas fa-smile"></i></button>
                        <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
                        <button id="send-message" class="send-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ€§èƒ½è®¾ç½®é€‰é¡¹ -->
    <div class="performance-toggle" id="performance-toggle" aria-label="æ€§èƒ½è®¾ç½®" role="button" tabindex="0">
        <div class="performance-toggle-icon">
            <i class="fas fa-sliders-h"></i>
        </div>
    </div>
    
    <div class="performance-menu" id="performance-menu" role="dialog" aria-label="æ€§èƒ½è®¾ç½®é€‰é¡¹">
        <h3>æ€§èƒ½é€‰é¡¹</h3>
        
        <div class="performance-option">
            <div class="performance-option-label">
                <span>åŠ¨ç”»æ•ˆæœ</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-animations" checked aria-label="å¯ç”¨åŠ¨ç”»æ•ˆæœ">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="option-description">å¯ç”¨æˆ–ç¦ç”¨å¡ç‰ŒåŠ¨ç”»æ•ˆæœ</div>
        </div>
        
        <div class="performance-option">
            <div class="performance-option-label">
                <span>æ¨¡ç³Šæ•ˆæœ</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-blur" checked aria-label="å¯ç”¨æ¨¡ç³Šæ•ˆæœ">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="option-description">å¯ç”¨æˆ–ç¦ç”¨èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ(æå‡æ€§èƒ½)</div>
        </div>
        
        <div class="performance-option">
            <div class="performance-option-label">
                <span>åŠ¨ç”»é€Ÿåº¦</span>
            </div>
            <input type="range" id="animation-speed" min="0.5" max="2" step="0.1" value="1" aria-label="åŠ¨ç”»é€Ÿåº¦">
            <div class="slider-labels">
                <span>æ…¢</span>
                <span>ä¸­</span>
                <span>å¿«</span>
            </div>
        </div>
    </div>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ä¸“ç”¨è„šæœ¬ -->
    <script src="{{ url_for('static', filename='js/tabs.js') }}"></script>
    
    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ç‹¬ç«‹è„šæœ¬ - ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å·¥ä½œ -->
    <script>
        // ç«‹å³æ‰§è¡Œçš„æ ‡ç­¾é¡µåˆ‡æ¢è„šæœ¬
        (function() {
            console.log('åˆå§‹åŒ–æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½...');
            
            // ä¸»æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            function initTabs() {
                const tabBtns = document.querySelectorAll('.tab-btn');
                if (tabBtns.length === 0) {
                    console.error('æœªæ‰¾åˆ°æ ‡ç­¾é¡µæŒ‰é’®');
                    return;
                }
                
                tabBtns.forEach(btn => {
                    // ç§»é™¤ç°æœ‰äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢é‡å¤ç»‘å®š
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    
                    // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                    newBtn.addEventListener('click', function(e) {
                        const targetTab = this.getAttribute('data-tab');
                        console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ: ' + targetTab);
                        
                        // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                        tabBtns.forEach(b => b.classList.remove('active'));
                        document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                        
                        // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°å½“å‰é€‰é¡¹
                        this.classList.add('active');
                        const pane = document.getElementById(targetTab + '-tab');
                        if (pane) {
                            pane.classList.add('active');
                        } else {
                            console.error('æ‰¾ä¸åˆ°å¯¹åº”çš„æ ‡ç­¾å†…å®¹: ' + targetTab + '-tab');
                        }
                    });
                });
                
                console.log('æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½å·²åˆå§‹åŒ–');
            }
            
            // å¦‚æœDOMå·²åŠ è½½å®Œæˆï¼Œç«‹å³åˆå§‹åŒ–æ ‡ç­¾é¡µ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTabs);
            } else {
                initTabs();
            }
            
            // å°è¯•ç›´æ¥ä¿®å¤åŠ å…¥æˆ¿é—´æŒ‰é’®
            setTimeout(function() {
                const joinRoomBtn = document.getElementById('join-room-btn');
                if (joinRoomBtn) {
                    console.log('å‘ç°åŠ å…¥æˆ¿é—´æŒ‰é’®ï¼Œæ·»åŠ ç›´æ¥ç‚¹å‡»äº‹ä»¶');
                    
                    // ç§»é™¤ç°æœ‰äº‹ä»¶ç›‘å¬å™¨
                    const newBtn = joinRoomBtn.cloneNode(true);
                    if (joinRoomBtn.parentNode) {
                        joinRoomBtn.parentNode.replaceChild(newBtn, joinRoomBtn);
                    }
                    
                    // æ·»åŠ ç›´æ¥çš„ç‚¹å‡»äº‹ä»¶å¤„ç†
                    newBtn.addEventListener('click', function() {
                        console.log('åŠ å…¥æˆ¿é—´æŒ‰é’®è¢«ç‚¹å‡»');
                        
                        const username = document.getElementById('join-username').value.trim();
                        const roomId = document.getElementById('room-id').value.trim();
                        
                        if (!username) {
                            alert('è¯·è¾“å…¥ç”¨æˆ·å');
                            return;
                        }
                        
                        if (!roomId) {
                            alert('è¯·è¾“å…¥æˆ¿é—´å·');
                            return;
                        }
                        
                        console.log(`å°è¯•åŠ å…¥æˆ¿é—´ - ç”¨æˆ·: ${username}, æˆ¿é—´: ${roomId}`);
                        
                        // ä½¿ç”¨Socket.IOåŠ å…¥æˆ¿é—´
                        if (typeof io !== 'undefined') {
                            const socket = io();
                            socket.emit('join_room', {
                                username: username,
                                room_id: roomId,
                                avatar: 'avatar1'
                            });
                            
                            alert('æ­£åœ¨åŠ å…¥æˆ¿é—´: ' + roomId + 'ï¼Œè¯·ç­‰å¾…...');
                        } else {
                            alert('Socket.IOæœªåŠ è½½ï¼Œæ— æ³•è¿æ¥æœåŠ¡å™¨');
                        }
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°åŠ å…¥æˆ¿é—´æŒ‰é’®');
                }
            }, 1000);
        })();
    </script>
    
    <!-- ä¸»æ¸¸æˆè„šæœ¬ -->
    <script src="{{ url_for('static', filename='js/simple.js') }}"></script>
</body>
</html> 